<ion-header>

  <back-to-root title="Population" [Pop]="true"></back-to-root>

</ion-header>

<ion-content padding>

  <h3>แบบข้อมูลประชากร</h3>

  <form (ngSubmit)="handleSubmit()" [formGroup]="f" [rx-form-data]="(formData$ | async)?.population">
    <ion-card>
      <ion-card-content>
        <ion-item>
          <ion-label>
            จำนวนผู้อยู่อาศัย
          </ion-label>
        </ion-item>

        <count [title]="'จำนวนผู้อยู่อาศัย'" [FormItem]="f" [count]="'personCount'"></count>

        <ion-item *ngIf="isValid('personCount')">
          <span class="invalid-msg">
            กรุณากรอกข้อมูล
          </span>
        </ion-item>
        <ion-row text-center *ngIf="f.get('personCount').value > 0">
          <ion-col>
            <ion-row>
              <ion-col col-2>
                <b>ลำดับที่</b>
              </ion-col>
              <ion-col col-3>
                <b>คำนำหน้าชื่อ</b>
              </ion-col>
              <ion-col col-3>
                <b>ชื่อตัว</b>
              </ion-col>
              <ion-col col-4>
                <b>ชื่อสกุล</b>
              </ion-col>
            </ion-row>
          </ion-col>
        </ion-row>

        <div *ngIf="f.get('personCount').value > 0" [class.invalid]="!isCheckHaveHeadfamily()">
          <div *ngFor="let far of f.get('persons').controls; let i = index">
            <ion-row align-items-center>
              <ion-col col-11>
                <table-population [no]="i + 1" [FormItem]="far" [FormArray]="f.get('persons')" [ProName]="proName">
                </table-population>
              </ion-col>
              <ion-col col-1>
                <button ion-button color="danger" (click)="deleteData(i)">ลบ</button>
              </ion-col>
            </ion-row>
          </div>
          <ion-item *ngIf="!isCheckHaveHeadfamily()">
            <span class="invalid-msg" item-right>
              ครัวเรือนนี้ยังไม่มีหัวหน้าครัวเรือน
            </span>
          </ion-item>
        </div>
      </ion-card-content>
    </ion-card>

    <ion-card class="invalid-msg" *ngIf="f.invalid && submitRequested">
      <ion-card-header>
        กรุณาตรวจสอบข้อมูลในแบบสำรวจ
      </ion-card-header>
      <ion-card-content>
        <ion-icon name="warning" item-start></ion-icon>
        ไม่สามารถบันทึกข้อมูลในฟอร์มสำรวจได้ โปรดตรวจแก้ไขข้อผิดพลาดด้านบนให้เรียบร้อยแล้วลองบันทึกอีกครั้ง
      </ion-card-content>
    </ion-card> 

    <form-buttons-bar frontNum="{{frontNum}}" backNum="{{backNum}}"></form-buttons-bar>

  </form>
</ion-content>